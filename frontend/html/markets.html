<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>YuMa - –†–∏–Ω–∫–∏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- –ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ —Ü—ñ —Ñ–∞–π–ª–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ ../css/ –≤—ñ–¥–Ω–æ—Å–Ω–æ frontend/html/ -->
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/markets.css"> <!-- –í–∞—à —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π CSS –¥–ª—è —Ü—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
    <style>
        /* –¢–∏–º—á–∞—Å–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Å—Ç–∞—Ä—Ç—É, –∫—Ä–∞—â–µ –≤–∏–Ω–µ—Å—Ç–∏ –≤ –æ–∫—Ä–µ–º—ñ —Ñ–∞–π–ª–∏ */
        body { font-family: Arial, sans-serif; margin: 0; background-color: #f4f6f8; color: #333; font-size: 1.6rem; }
        header { background-color: #1a1a2e; color: white; padding: 1.5rem 3rem; display: flex; justify-content: space-between; align-items: center; }
        .logo a { color: white; text-decoration: none; font-size: 2.4rem; font-weight: bold; }
        .header-nav a.nav-button, .header-actions button.nav-button {
            color: #e0e0e0; text-decoration: none; margin-left: 2rem; font-size: 1.5rem;
            background-color: transparent; border: 1px solid #4a4e69; padding: 0.8rem 1.5rem;
            border-radius: 0.6rem; cursor: pointer; transition: background-color 0.2s, color 0.2s;
        }
        .header-nav a.nav-button:hover, .header-actions button.nav-button:hover,
        .header-nav a.nav-button.active {
            background-color: #e0e0e0; color: #1a1a2e; border-color: #e0e0e0;
        }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        .icon-placeholder { width: 3rem; height: 3rem; border: 1px solid #777; background-color: #555; border-radius: 0.4rem; display: flex; align-items: center; justify-content: center; }
        .user-profile-icon a { font-size: 1.8rem; text-decoration: none; color: white; }

        .market-page-layout { padding: 2rem; max-width: 1400px; margin: 0 auto; }
        .asset-selector-bar {
            display: flex; gap: 1rem; margin-bottom: 2rem; overflow-x: auto;
            padding-bottom: 1rem; -webkit-overflow-scrolling: touch;
            border-bottom: 1px solid #e0e0e0;
        }
        .asset-button {
            padding: 0.8rem 1.5rem; border: 1px solid #d1d5db; border-radius: 0.6rem;
            background-color: #fff; cursor: pointer; font-size: 1.4rem;
            white-space: nowrap; transition: background-color 0.2s, border-color 0.2s, color 0.2s;
            color: #374151;
        }
        .asset-button:hover { background-color: #f3f4f6; border-color: #9ca3af; }
        .asset-button.active { background-color: #1a1a2e; color: white; border-color: #1a1a2e; }

        .popular-pairs-section, .filtered-pairs-section { margin-bottom: 3rem; }
        .section-title-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid #e0e0e0; padding-bottom: 1rem;}
        .section-title { font-size: 2.2rem; color: #1a1a2e; margin: 0; }
        .search-input-container { /* –ó–∞–ª–∏—à–∞—î–º–æ –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ, —è–∫—â–æ –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è */ }
        .search-input {
            padding: 0.8rem 1.2rem; border: 1px solid #d1d5db; border-radius: 0.6rem;
            font-size: 1.4rem; width: 100%; max-width: 280px;
        }

        .custom-table-wrapper { margin-top: 1rem; background-color: #fff; border-radius: 0.8rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); overflow: hidden;}
        .custom-table-header, .custom-table-row { display: flex; align-items: center; padding: 1.2rem 1rem; }
        .custom-table-row { border-top: 1px solid #f3f4f6; }
        .custom-table-header { font-weight: 600; color: #4b5563; font-size: 1.3rem; background-color: #f9fafb; text-transform: uppercase; letter-spacing: 0.05em;}
        .custom-table-header span, .custom-table-row span { flex: 1; padding: 0 0.8rem; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}

        .custom-table-header span.col-fav, .custom-table-row span.col-fav { flex-basis: 5rem; flex-grow: 0; text-align: center;}
        .custom-table-header span.col-pair, .custom-table-row span.col-pair { flex-grow: 1.2; min-width: 100px; font-weight: 500;}
        .custom-table-header span.col-name, .custom-table-row span.col-name { flex-grow: 2; min-width: 180px; color: #6b7280;}
        .custom-table-header span.col-price, .custom-table-row span.col-price { flex-grow: 1; text-align: right; min-width: 100px;}
        .custom-table-header span.col-change, .custom-table-row span.col-change { flex-grow: 1; text-align: right; min-width: 90px;}
        .custom-table-header span.col-action, .custom-table-row span.col-action { flex-grow: 0.8; text-align: center; min-width: 80px;}

        .custom-table-row:hover { background-color: #f9fafb; }
        .no-data-placeholder { text-align: center; padding: 3rem 2rem; color: #6b7280; font-style: italic; font-size: 1.5rem; }
        .favourite-btn { cursor: pointer; font-size: 2rem; color: #d1d5db; border: none; background: none; padding: 0.2rem 0.5rem; transition: color 0.2s; }
        .favourite-btn.is-favourite { color: #f59e0b; } /* –ñ–æ–≤—Ç–∏–π/–∑–æ–ª–æ—Ç–∏–π –¥–ª—è —É–ª—é–±–ª–µ–Ω–æ–≥–æ */
        .positive-change { color: #10b981; } /* –ó–µ–ª–µ–Ω–∏–π */
        .negative-change { color: #ef4444; } /* –ß–µ—Ä–≤–æ–Ω–∏–π */
        .action-link { color: #3b82f6; text-decoration: none; font-size: 1.4rem; font-weight: 500; }
        .action-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <header>
        <div class="logo"><a href="../../index.html">YuMa</a></div>
        <nav class="header-nav">
            <a href="buy_crypto-page.html" class="nav-button">Buy Crypto</a>
            <a href="markets.html" class="nav-button active">Markets</a>
            <a href="trading-page.html" class="nav-button">Trade</a>
        </nav>
        <div class="header-actions">
            <button class="btn-deposit nav-button" onclick="window.location.href='deposit.html'">Deposit</button>
            <div class="icon-placeholder dark-square"></div>
            <div class="icon-placeholder"></div>
            <div class="icon-placeholder user-profile-icon"><a href="profile.html" title="Profile">üë§</a></div>
            <div class="icon-placeholder"></div>
            <button id="logoutButtonMarkets" class="nav-button" style="display: none;">Log out</button>
        </div>
    </header>

    <main class="market-page-layout">
        <nav class="asset-selector-bar" id="assetSelectorBar">
            <div class="no-data-placeholder">Loading assets...</div>
        </nav>

        <section class="popular-pairs-section">
            <div class="section-title-container">
                <h2 class="section-title">Popular Pairs</h2>
            </div>
            <div class="custom-table-wrapper" id="popularPairsTable">
                <div class="custom-table-header">
                    <span class="col-fav">Fav</span>
                    <span class="col-pair">Pair</span>
                    <span class="col-name">Name</span>
                    <span class="col-price">Last Price</span>
                    <span class="col-change">24h Change</span>
                    <span class="col-action">Action</span>
                </div>
                <div class="no-data-placeholder">Loading popular pairs...</div>
            </div>
        </section>

        <section class="filtered-pairs-section">
             <div class="section-title-container">
                <h2 class="section-title" id="filteredPairsTitle">All Markets</h2>
                <div class="search-input-container">
                    <input type="text" id="searchMarketInput" placeholder="Search Pair, e.g. BTC or Bitcoin" class="search-input">
                </div>
            </div>
            <div class="custom-table-wrapper" id="filteredPairsTable">
                 <div class="custom-table-header">
                    <span class="col-fav">Fav</span>
                    <span class="col-pair">Pair</span>
                    <span class="col-name">Name</span>
                    <span class="col-price">Last Price</span>
                    <span class="col-change">24h Change</span>
                    <span class="col-action">Action</span>
                </div>
                <div class="no-data-placeholder">Select a base asset or view all markets.</div>
            </div>
        </section>
    </main>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    console.log('[MarketsPage] DOMContentLoaded. Script loaded.');
    const token = localStorage.getItem('authToken');
    const assetSelectorBar = document.getElementById('assetSelectorBar');
    const popularPairsTable = document.getElementById('popularPairsTable');
    const filteredPairsTable = document.getElementById('filteredPairsTable');
    const filteredPairsTitle = document.getElementById('filteredPairsTitle');
    const logoutButton = document.getElementById('logoutButtonMarkets');
    const searchInput = document.getElementById('searchMarketInput');

    let allMarketsDataCache = [];

    if (token && logoutButton) {
        logoutButton.style.display = 'inline-block';
        logoutButton.addEventListener('click', async () => {
            console.log('[MarketsPage] Logout clicked.');
            const currentToken = localStorage.getItem('authToken'); // –û—Ç—Ä–∏–º—É—î–º–æ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞–ø–∏—Ç—É
            localStorage.removeItem('authToken');
            try {
                // –ù–∞–¥—Å–∏–ª–∞—î–º–æ —Ç–æ–∫–µ–Ω, —â–æ–± —Å–µ—Ä–≤–µ—Ä –º—ñ–≥ –π–æ–≥–æ —ñ–Ω–≤–∞–ª—ñ–¥—É–≤–∞—Ç–∏, —è–∫—â–æ —Ç–∞–∫–∞ –ª–æ–≥—ñ–∫–∞ —î
                await fetch('/auth/logout', { method: 'POST', headers: { 'Authorization': `Bearer ${currentToken}` }});
            } catch(e) { console.error('Logout API error', e); }
            window.location.href = 'login-page.html'; // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—Ö–æ–¥—É
        });
    } else if(logoutButton) {
        logoutButton.style.display = 'none';
    }

    async function fetchProtectedData(url, options = {}) {
        const currentToken = localStorage.getItem('authToken'); // –ó–∞–≤–∂–¥–∏ –±–µ—Ä–µ–º–æ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Ç–æ–∫–µ–Ω
        const requiresAuth = options.requiresAuth !== undefined ? options.requiresAuth : true;

        const headers = { 'Content-Type': 'application/json' };
        if (requiresAuth && currentToken) {
            headers['Authorization'] = `Bearer ${currentToken}`;
        } else if (requiresAuth && !currentToken) { // –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è, –∞ —Ç–æ–∫–µ–Ω–∞ –Ω–µ–º–∞—î
             console.warn(`[fetchProtectedData] Auth required for ${url} but no token. Redirecting.`);
             window.location.href = 'login-page.html';
             return Promise.reject({ success: false, message: 'Authentication required.', shouldRedirect: true });
        }

        const fetchOptions = { ...options, headers: { ...headers, ...options.headers } };

        try {
            const response = await fetch(url, fetchOptions);
            if (!response.ok) {
                if ((response.status === 401 || response.status === 403) && requiresAuth) {
                    localStorage.removeItem('authToken');
                    window.location.href = 'login-page.html';
                    return Promise.reject({ success: false, message: `Unauthorized or Forbidden for ${url}. Redirecting.`, shouldRedirect: true });
                }
                const errorData = await response.json().catch(() => ({ message: `HTTP error! Status: ${response.status}` }));
                return Promise.reject({ success: false, ...errorData });
            }
            return response.json();
        } catch (error) {
             console.error(`[fetchProtectedData] Network or other error for ${url}:`, error);
             return Promise.reject({ success: false, message: error.message || `Network error fetching ${url}.` });
        }
    }

    function attachFavouriteButtonListeners(containerElement) {
        if (!token) return;
        containerElement.querySelectorAll('.favourite-btn').forEach(button => {
            button.removeEventListener('click', toggleFavourite); // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—é
            button.addEventListener('click', toggleFavourite);
        });
    }

    function renderMarketTable(containerElement, markets, titleForFiltered) {
        const header = containerElement.querySelector('.custom-table-header');
        const currentPlaceholder = containerElement.querySelector('.no-data-placeholder');
        if (currentPlaceholder) currentPlaceholder.remove();

        const rows = containerElement.querySelectorAll('.custom-table-row');
        rows.forEach(row => row.remove());

        if (titleForFiltered && filteredPairsTitle && containerElement === filteredPairsTable) {
            filteredPairsTitle.textContent = titleForFiltered;
        }

        if (!markets || markets.length === 0) {
            containerElement.insertAdjacentHTML('beforeend', `<div class="no-data-placeholder">No markets found${titleForFiltered ? ' for ' + titleForFiltered.replace('Markets for ', '').replace('All Markets', ' for current filter') : ''}.</div>`);
            return;
        }

        markets.forEach(market => {
            const row = document.createElement('div');
            row.classList.add('custom-table-row');
            row.dataset.marketId = market.id;

            const isFav = token ? market.isFavourite : false;
            const price = market.currentPrice ? `$${parseFloat(market.currentPrice).toFixed(2)}` : 'N/A';
            const change = market.change24hPercent ? parseFloat(market.change24hPercent).toFixed(2) + '%' : 'N/A';
            const changeClass = market.change24hPercent ? (parseFloat(market.change24hPercent) >= 0 ? 'positive-change' : 'negative-change') : '';

            row.innerHTML = `
                <span class="col-fav">
                    ${token ? `<button class="favourite-btn ${isFav ? 'is-favourite' : ''}" data-market-id="${market.id}" title="${isFav ? 'Remove from Favourites' : 'Add to Favourites'}">${isFav ? '‚òÖ' : '‚òÜ'}</button>` : '‚òÜ'}
                </span>
                <span class="col-pair">${market.symbol}</span>
                <span class="col-name">${market.name || `${market.base_asset}/${market.quote_asset}`}</span>
                <span class="col-price">${price}</span>
                <span class="col-change ${changeClass}">${change}</span>
                <span class="col-action"><a href="trading-page.html?pair=${market.symbol.replace('/', '_')}" class="action-link">Trade</a></span>
            `;
            containerElement.appendChild(row);
        });
        
        attachFavouriteButtonListeners(containerElement);
    }

    async function toggleFavourite(event) {
        if (!token) { alert('Please log in to manage your favourites.'); window.location.href = 'login-page.html'; return; }
        const button = event.currentTarget;
        const marketId = button.dataset.marketId;
        const isCurrentlyFavourite = button.classList.contains('is-favourite');
        const method = isCurrentlyFavourite ? 'DELETE' : 'POST';
        const url = isCurrentlyFavourite ? `/api/favourites/${marketId}` : '/api/favourites';

        try {
            const fetchOptions = { method: method, requiresAuth: true };
            if (method === 'POST') {
                fetchOptions.body = JSON.stringify({ marketPairId: parseInt(marketId) });
            }
            const data = await fetchProtectedData(url, fetchOptions);

            if (data.success) {
                // –û–Ω–æ–≤–ª—é—î–º–æ –∫–Ω–æ–ø–∫—É, –Ω–∞ —è–∫—É –∫–ª—ñ–∫–Ω—É–ª–∏
                button.classList.toggle('is-favourite');
                button.innerHTML = button.classList.contains('is-favourite') ? '‚òÖ' : '‚òÜ';
                button.title = button.classList.contains('is-favourite') ? 'Remove from Favourites' : 'Add to Favourites';
                
                // –û–Ω–æ–≤–ª—é—î–º–æ isFavourite –≤ –∫–µ—à—ñ
                const marketInCache = allMarketsDataCache.find(m => m.id.toString() === marketId);
                if(marketInCache) {
                    marketInCache.isFavourite = !isCurrentlyFavourite;
                }

                // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –∫–Ω–æ–ø–∫—É –≤ —ñ–Ω—à—ñ–π —Ç–∞–±–ª–∏—Ü—ñ, —è–∫—â–æ –≤–æ–Ω–∞ —Ç–∞–º —î
                const otherTable = button.closest('#popularPairsTable') ? filteredPairsTable : popularPairsTable;
                const correspondingButton = otherTable.querySelector(`.favourite-btn[data-market-id="${marketId}"]`);
                if (correspondingButton) {
                    correspondingButton.classList.toggle('is-favourite', !isCurrentlyFavourite);
                    correspondingButton.innerHTML = !isCurrentlyFavourite ? '‚òÖ' : '‚òÜ';
                    correspondingButton.title = !isCurrentlyFavourite ? 'Remove from Favourites' : 'Add to Favourites';
                }

            } else {
                alert(data.message || 'Failed to update favourites.');
            }
        } catch (error) {
            console.error('Error toggling favourite:', error);
            alert(error.message || 'An error occurred. Please try again.');
        }
    }
    
    function filterAndRenderSpotMarkets() {
        const searchTerm = searchInput ? searchInput.value.toLowerCase() : "";
        const activeAssetButton = assetSelectorBar.querySelector('.asset-button.active');
        const selectedBaseAsset = (activeAssetButton && activeAssetButton.dataset.asset !== undefined && activeAssetButton.textContent !== 'All') 
                                  ? activeAssetButton.dataset.asset 
                                  : null;

        const filtered = allMarketsDataCache.filter(market => {
            const matchesSearch = searchTerm === '' ||
                market.symbol.toLowerCase().includes(searchTerm) || 
                (market.name && market.name.toLowerCase().includes(searchTerm)) ||
                market.base_asset.toLowerCase().includes(searchTerm) ||
                market.quote_asset.toLowerCase().includes(searchTerm);
            
            const matchesBaseAsset = !selectedBaseAsset || market.base_asset === selectedBaseAsset;
            return matchesSearch && matchesBaseAsset;
        });

        const title = selectedBaseAsset ? `Markets for ${selectedBaseAsset}` : (searchTerm ? 'Search Results' : 'All Markets');
        renderMarketTable(filteredPairsTable, filtered, title);
    }

    async function loadBaseAssets() {
        console.log('[MarketsPage] Loading base assets...');
        const placeholder = assetSelectorBar.querySelector('.no-data-placeholder');
        try {
            const data = await fetchProtectedData('/api/assets/base', { requiresAuth: false });
            if (placeholder) placeholder.remove();

            if (data.success && data.baseAssets) {
                assetSelectorBar.innerHTML = ''; // –û—á–∏—â–∞—î–º–æ –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–¥ –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º
                const allMarketsButton = document.createElement('button');
                allMarketsButton.classList.add('asset-button', 'active'); // "All" –∞–∫—Ç–∏–≤–Ω–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
                allMarketsButton.textContent = 'All';
                allMarketsButton.addEventListener('click', () => {
                    document.querySelectorAll('.asset-button.active').forEach(b => b.classList.remove('active'));
                    allMarketsButton.classList.add('active');
                    if(searchInput) searchInput.value = ''; // –û—á–∏—â–∞—î–º–æ –ø–æ—à—É–∫ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∞
                    filterAndRenderSpotMarkets();
                });
                assetSelectorBar.appendChild(allMarketsButton);

                data.baseAssets.forEach(asset => {
                    const button = document.createElement('button');
                    button.classList.add('asset-button');
                    button.textContent = asset;
                    button.dataset.asset = asset;
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.asset-button.active').forEach(b => b.classList.remove('active'));
                        button.classList.add('active');
                        if(searchInput) searchInput.value = ''; // –û—á–∏—â–∞—î–º–æ –ø–æ—à—É–∫ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∞
                        filterAndRenderSpotMarkets();
                    });
                    assetSelectorBar.appendChild(button);
                });
            } else {
                throw new Error(data.message || 'Failed to load base assets');
            }
        } catch (error) {
            console.error('[MarketsPage] Error loading base assets:', error);
            if(placeholder) placeholder.textContent = 'Failed to load assets.';
            else assetSelectorBar.insertAdjacentHTML('beforeend', '<div class="no-data-placeholder">Failed to load assets.</div>');
        }
    }

    async function loadPopularPairs() {
        console.log('[MarketsPage] Loading popular pairs...');
        const placeholder = popularPairsTable.querySelector('.no-data-placeholder');
        try {
            const data = await fetchProtectedData('/api/markets?popularOnly=true', { requiresAuth: !!token });
            if (placeholder) placeholder.remove();
            if (data.success && data.markets) {
                renderMarketTable(popularPairsTable, data.markets);
            } else {
                throw new Error(data.message || 'Failed to load popular pairs');
            }
        } catch (error) {
            console.error('[MarketsPage] Error loading popular pairs:', error);
            if(placeholder) placeholder.textContent = 'Error loading popular pairs.';
            else popularPairsTable.insertAdjacentHTML('beforeend', '<div class="no-data-placeholder">Error loading popular pairs.</div>');
        }
    }

    async function loadInitialAllMarkets() { // –ü–µ—Ä–µ–π–º–µ–Ω–æ–≤–∞–Ω–æ, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–ª—É—Ç–∞–Ω–∏–Ω–∏ –∑ filterAndRender
        console.log('[MarketsPage] Loading initial set of all markets for cache...');
        const placeholder = filteredPairsTable.querySelector('.no-data-placeholder');
        if (placeholder) placeholder.textContent = 'Loading all markets...';

        try {
            const data = await fetchProtectedData('/api/markets', { requiresAuth: !!token });
             if (placeholder) placeholder.remove(); // –í–∏–¥–∞–ª—è—î–º–æ "Loading all markets..."
            if (data.success && data.markets) {
                allMarketsDataCache = data.markets;
                filterAndRenderSpotMarkets(); // –ü–µ—Ä—à–∏–π —Ä–µ–Ω–¥–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫–µ—à—É (–ø–æ–∫–∞–∂–µ "All Markets")
            } else {
                throw new Error(data.message || 'Failed to load all markets');
            }
        } catch (error) {
            console.error('[MarketsPage] Error loading initial all markets:', error);
            if(placeholder) placeholder.textContent = 'Error loading all markets.';
            else filteredPairsTable.insertAdjacentHTML('beforeend', '<div class="no-data-placeholder">Error loading all markets.</div>');
        }
    }
    
    if(searchInput) searchInput.addEventListener('input', filterAndRenderSpotMarkets);

    // –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    await loadBaseAssets();
    await loadPopularPairs();
    await loadInitialAllMarkets(); 
    console.log('[MarketsPage] Initial data loading complete.');
});
</script>
</body>
</html>