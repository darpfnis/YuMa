<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - YuMa</title>
    <!-- –í–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ —à–ª—è—Ö–∏ –¥–æ CSS, –ø—Ä–∏–ø—É—Å–∫–∞—é—á–∏, —â–æ profile.html –≤ frontend/html/ -->
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/global.css">
    <!-- <script defer src="../js/script.js"></script> -- –Ø–∫—â–æ —î –∑–∞–≥–∞–ª—å–Ω–∏–π —Å–∫—Ä–∏–ø—Ç -->
</head>
<body>
    <header>
        <!-- –í–ò–ü–†–ê–í–õ–ï–ù–û –®–õ–Ø–• –î–û index.html (—è–∫–∏–π –≤ –∫–æ—Ä–µ–Ω—ñ) -->
        <div class="logo"><a href="../../index.html">YuMa</a></div>
        <nav class="header-nav">
            <!-- –í–ò–ü–†–ê–í–õ–ï–ù–û –®–õ–Ø–•–ò –î–û –Ü–ù–®–ò–• HTML-–°–¢–û–†–Ü–ù–û–ö (—è–∫—ñ –≤ frontend/html/) -->
            <a href="buy_crypto-page.html" class="nav-button">Buy Crypto</a>
            <a href="markets.html" class="nav-button">Markets</a>
            <a href="trading-page.html" class="nav-button">Trade</a>
        </nav>
        <div class="header-actions">
            <button class="btn-deposit nav-button">Deposit</button>
            <div class="icon-placeholder dark-square"></div>
            <div class="icon-placeholder"></div>
            <div class="icon-placeholder"></div>
            <div class="icon-placeholder"></div>
            <div class="icon-placeholder user-profile-icon"><a href="profile.html" title="Profile">üë§</a></div> <!-- –Ü–∫–æ–Ω–∫–∞ –ø—Ä–æ—Ñ—ñ–ª—é -->
            <button id="logoutButton" class="nav-button" style="display: none;">Log out</button> <!-- –ö–Ω–æ–ø–∫–∞ –≤–∏—Ö–æ–¥—É, —Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ -->
        </div>
    </header>

    <div class="page-wrapper-profile">
        <aside class="sidebar">
            <nav>
                <a href="profile.html" class="sidebar-button active">dashboard</a>
                <a href="assets.html" class="sidebar-button">assets</a>
                <a href="order.html" class="sidebar-button">order</a>
                <a href="account.html" class="sidebar-button">account</a>
                <a href="settings.html" class="sidebar-button">settings</a>
            </nav>
        </aside>

        <main class="main-content-profile">
            <section class="user-info-header">
                <div class="user-avatar-placeholder" id="userAvatar">picture</div>
                <div class="user-details">
                    <h2 id="userName">Loading...</h2> <!-- ID –¥–ª—è —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ -->
                    <span class="uid-placeholder" id="userUID">UID: Loading...</span> <!-- ID –¥–ª—è UID -->
                </div>
            </section>

            <section class="dashboard-cards">
                <div class="profile-card card-balance">
                    <p>Estimated Balance</p>
                    <h3 id="estimatedBalance">$0.00 USD</h3> <!-- ID –¥–ª—è –±–∞–ª–∞–Ω—Å—É -->
                </div>
                <div class="profile-card card-chart">
                    <p>Portfolio Chart</p>
                    <div id="portfolioChartPlaceholder" style="width:100%; height:150px; background:#f0f0f0; display:flex; align-items:center; justify-content:center;">Chart Area</div>
                </div>
            </section>

            <section class="markets-section">
                <h3>My Favourite Markets</h3> <!-- –ó–º—ñ–Ω–∏–≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø—Ä–∏–∫–ª–∞–¥—É -->
                <div class="market-filters">
                    <button class="filter-button active" data-filter="favourite">Favourite</button>
                    <button class="filter-button" data-filter="holding">Holding</button>
                    <button class="filter-button" data-filter="hot">Hot</button>
                    <!-- ... —ñ–Ω—à—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ ... -->
                </div>
                <div class="market-table-container" id="favouriteMarketsTable">
                    <div class="custom-table-header"> <!-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ custom-table-header -->
                        <span>Coin</span>
                        <span>Last Price</span>
                        <span>24h Change</span>
                        <span>Action</span>
                    </div>
                    <!-- –°—é–¥–∏ –±—É–¥—É—Ç—å –¥–∏–Ω–∞–º—ñ—á–Ω–æ –¥–æ–¥–∞–≤–∞—Ç–∏—Å—è —Ä—è–¥–∫–∏ -->
                    <div class="no-data-placeholder">Loading favourite markets...</div>
                </div>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const userNameElement = document.getElementById('userName');
    const userUIDElement = document.getElementById('userUID');
    const estimatedBalanceElement = document.getElementById('estimatedBalance');
    const favouriteMarketsTable = document.getElementById('favouriteMarketsTable');
    const logoutButton = document.getElementById('logoutButton');

    // –£–í–ê–ì–ê: –¶–µ MVP! –î–ª—è —Ä–µ–∞–ª—å–Ω–æ—ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω—ñ JWT –∞–±–æ —Å–µ—Å—ñ—ó.
    // –ó–∞—Ä–∞–∑ –º–∏ –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ–º–æ email –∑ localStorage, —è–∫ —Ä–æ–±–∏–ª–∏ —Ä–∞–Ω—ñ—à–µ –¥–ª—è MVP.
    // –£ —Ä–µ–∞–ª—å–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É —Ç—É—Ç –±—É–ª–∞ –± –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞.
    const userEmailForMVP = localStorage.getItem('userEmailForMVP');

    if (!userEmailForMVP) {
        // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ "–∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π" (–Ω–µ–º–∞—î email –≤ localStorage),
        // –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—Ö–æ–¥—É.
        // –í —Ä–µ–∞–ª—å–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É —Ç—É—Ç –±—É–ª–∞ –± –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∑ —Å–µ—Ä–≤–µ—Ä–∞.
        window.location.href = 'login-page.html'; // –ê–±–æ ../../login-page.html —è–∫—â–æ –≤–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ –∑ frontend/html/
        return;
    }

    // –Ø–∫—â–æ "–∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π", –ø–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É –≤–∏—Ö–æ–¥—É
    if (logoutButton) {
        logoutButton.style.display = 'inline-block';
        logoutButton.addEventListener('click', () => {
            localStorage.removeItem('userEmailForMVP'); // –í–∏–¥–∞–ª—è—î–º–æ "—Å–µ—Å—ñ—é" MVP
            // –í —Ä–µ–∞–ª—å–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É —Ç—É—Ç –±—É–≤ –±–∏ –∑–∞–ø–∏—Ç –Ω–∞ /auth/logout –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            window.location.href = 'login-page.html'; // –ê–±–æ ../../login-page.html
        });
    }

    // --- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ—Ñ—ñ–ª—é (–ø—Ä–∏–∫–ª–∞–¥) ---
    // –£ —Ä–µ–∞–ª—å–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É —Ç—É—Ç –±—É–≤ –±–∏ fetch –∑–∞–ø–∏—Ç –¥–æ –≤–∞—à–æ–≥–æ API, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, /api/profile
    // –∑ —Ç–æ–∫–µ–Ω–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó. –ó–∞—Ä–∞–∑ —ñ–º—ñ—Ç—É—î–º–æ –¥–∞–Ω—ñ.
    if (userNameElement) userNameElement.textContent = userEmailForMVP.split('@')[0]; // –ü–æ–∫–∞–∑—É—î–º–æ —á–∞—Å—Ç–∏–Ω—É email
    if (userUIDElement) userUIDElement.textContent = `UID: FAKE${Math.random().toString(36).substr(2, 9).toUpperCase()}`; // –§–µ–π–∫–æ–≤–∏–π UID

    // --- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É (–ø—Ä–∏–∫–ª–∞–¥) ---
    // fetch('/api/balance', { headers: { 'Authorization': `Bearer ${—Ç–æ–∫–µ–Ω}` }})
    // .then(res => res.json()).then(data => {
    //     if (estimatedBalanceElement) estimatedBalanceElement.textContent = `$${data.balance.toFixed(2)} USD`;
    // });
    if (estimatedBalanceElement) estimatedBalanceElement.textContent = `$${(Math.random() * 10000).toFixed(2)} USD`; // –§–µ–π–∫–æ–≤–∏–π –±–∞–ª–∞–Ω—Å

    // --- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —É–ª—é–±–ª–µ–Ω–∏—Ö —Ä–∏–Ω–∫—ñ–≤ (–ø—Ä–∏–∫–ª–∞–¥) ---
    // fetch('/api/markets/favourites', { headers: { 'Authorization': `Bearer ${—Ç–æ–∫–µ–Ω}` }})
    // .then(res => res.json()).then(markets => {
    //     if (favouriteMarketsTable) {
    //         const noDataPlaceholder = favouriteMarketsTable.querySelector('.no-data-placeholder');
    //         if (noDataPlaceholder) noDataPlaceholder.remove();

    //         // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ä—è–¥–∫–∏, –∫—Ä—ñ–º –∑–∞–≥–æ–ª–æ–≤–∫–∞
    //         const rows = favouriteMarketsTable.querySelectorAll('.custom-table-row');
    //         rows.forEach(row => row.remove());

    //         markets.forEach(market => {
    //             const row = document.createElement('div');
    //             row.classList.add('custom-table-row'); // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ custom-table-row
    //             row.innerHTML = `
    //                 <span class="coin-name">${market.pair.split('/')[0]} <span class="coin-symbol-small">(${market.pair})</span></span>
    //                 <span>$${market.lastPrice.toFixed(2)}</span>
    //                 <span class="${market.change24h >= 0 ? 'positive-change' : 'negative-change'}">${market.change24h.toFixed(2)}%</span>
    //                 <span><a href="trading-page.html?pair=${market.pair}" class="action-link">Trade</a></span>
    //             `;
    //             favouriteMarketsTable.appendChild(row);
    //         });
    //     }
    // });
    // –Ü–º—ñ—Ç–∞—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–∏–Ω–∫—ñ–≤
    if (favouriteMarketsTable) {
        const noDataPlaceholder = favouriteMarketsTable.querySelector('.no-data-placeholder');
        if (noDataPlaceholder) noDataPlaceholder.textContent = 'No favourite markets yet.';
        // –¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ —Ñ–µ–π–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó
        const fakeMarkets = [
            { pair: 'BTC/USDT', lastPrice: 40000, change24h: 2.5 },
            { pair: 'ETH/USDT', lastPrice: 2500, change24h: -1.2 }
        ];
        const rows = favouriteMarketsTable.querySelectorAll('.custom-table-row');
        rows.forEach(row => row.remove()); // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ, —è–∫—â–æ –±—É–ª–∏ –≤ HTML

        fakeMarkets.forEach(market => {
            const row = document.createElement('div');
            row.classList.add('custom-table-row');
            row.innerHTML = `
                <span class="coin-name">${market.pair.split('/')[0]} <span class="coin-symbol-small">(${market.pair.replace('/', '')})</span></span>
                <span>$${market.lastPrice.toFixed(2)}</span>
                <span class="${market.change24h >= 0 ? 'positive-change' : 'negative-change'}">${market.change24h.toFixed(2)}%</span>
                <span><a href="trading-page.html?pair=${market.pair.replace('/', '_')}" class="action-link">Trade</a></span>
            `; // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ _ –∑–∞–º—ñ—Å—Ç—å / –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ URL
            favouriteMarketsTable.appendChild(row);
        });
    }

    // –î–æ–¥–∞–π—Ç–µ –ª–æ–≥—ñ–∫—É –¥–ª—è –∫–Ω–æ–ø–∫–∏ "Log out" —Ç–∞ —ñ–Ω—à–∏—Ö –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
});
</script>
</body>
</html>